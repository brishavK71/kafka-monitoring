global:
  resolve_timeout: 5m
  smtp_from: 'kafka-alerts@yourdomain.com'
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_auth_username: 'your-email@gmail.com'
  smtp_auth_password: 'your-app-password'
  smtp_require_tls: true

# Templates for email notifications
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# Route configuration
route:
  group_by: ['alertname', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'email-notifications'
  
  routes:
    # Critical alerts - immediate notification
    - match:
        severity: critical
      receiver: 'email-critical'
      group_wait: 10s
      repeat_interval: 4h
    
    # Warning alerts - less frequent
    - match:
        severity: warning
      receiver: 'email-warnings'
      group_wait: 30s
      repeat_interval: 12h

# Receivers configuration
receivers:
  - name: 'email-notifications'
    email_configs:
      - to: 'team@yourdomain.com'
        headers:
          Subject: '[Kafka Alert] {{ .GroupLabels.alertname }}'
        html: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
              .alert { border-left: 4px solid #d9534f; padding: 15px; margin: 10px 0; background-color: #f2dede; }
              .header { background-color: #d9534f; color: white; padding: 20px; text-align: center; }
              .info { background-color: #f5f5f5; padding: 10px; margin: 10px 0; }
              .label { font-weight: bold; color: #333; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>üö® Kafka Services Alert</h1>
            </div>
            <div style="padding: 20px;">
              {{ range .Alerts }}
              <div class="alert">
                <h2>{{ .Labels.alertname }}</h2>
                <div class="info">
                  <p><span class="label">Service:</span> {{ .Labels.service }}</p>
                  <p><span class="label">Severity:</span> {{ .Labels.severity }}</p>
                  <p><span class="label">Description:</span> {{ .Annotations.description }}</p>
                  <p><span class="label">Started At:</span> {{ .StartsAt }}</p>
                </div>
              </div>
              {{ end }}
            </div>
          </body>
          </html>

  - name: 'email-critical'
    email_configs:
      - to: 'oncall@yourdomain.com,team@yourdomain.com'
        headers:
          Subject: 'üö® [CRITICAL] Kafka Alert: {{ .GroupLabels.alertname }}'
        html: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
              .critical { border-left: 4px solid #d9534f; padding: 15px; margin: 10px 0; background-color: #f2dede; }
              .header { background-color: #c9302c; color: white; padding: 20px; text-align: center; }
              .info { background-color: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
              .label { font-weight: bold; color: #c9302c; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>üö® CRITICAL KAFKA ALERT</h1>
              <p>Immediate action required!</p>
            </div>
            <div style="padding: 20px;">
              {{ range .Alerts }}
              <div class="critical">
                <h2>{{ .Labels.alertname }}</h2>
                <div class="info">
                  <p><span class="label">Service:</span> {{ .Labels.service }}</p>
                  <p><span class="label">Severity:</span> {{ .Labels.severity }}</p>
                  <p><span class="label">Summary:</span> {{ .Annotations.summary }}</p>
                  <p><span class="label">Description:</span> {{ .Annotations.description }}</p>
                  <p><span class="label">Started At:</span> {{ .StartsAt }}</p>
                  {{ if .EndsAt }}
                  <p><span class="label">Ended At:</span> {{ .EndsAt }}</p>
                  {{ end }}
                </div>
              </div>
              {{ end }}
            </div>
          </body>
          </html>

  - name: 'email-warnings'
    email_configs:
      - to: 'team@yourdomain.com'
        headers:
          Subject: '‚ö†Ô∏è  [WARNING] Kafka Alert: {{ .GroupLabels.alertname }}'
        html: |
          <!DOCTYPE html>
          <html>
          <head>
            <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
              .warning { border-left: 4px solid #f0ad4e; padding: 15px; margin: 10px 0; background-color: #fcf8e3; }
              .header { background-color: #f0ad4e; color: white; padding: 20px; text-align: center; }
              .info { background-color: #f5f5f5; padding: 10px; margin: 10px 0; }
              .label { font-weight: bold; color: #8a6d3b; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>‚ö†Ô∏è Kafka Warning</h1>
            </div>
            <div style="padding: 20px;">
              {{ range .Alerts }}
              <div class="warning">
                <h2>{{ .Labels.alertname }}</h2>
                <div class="info">
                  <p><span class="label">Service:</span> {{ .Labels.service }}</p>
                  <p><span class="label">Description:</span> {{ .Annotations.description }}</p>
                  <p><span class="label">Started At:</span> {{ .StartsAt }}</p>
                </div>
              </div>
              {{ end }}
            </div>
          </body>
          </html>

# Inhibition rules - prevent notification spam
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']
